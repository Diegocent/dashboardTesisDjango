{% extends 'base.html' %} {% block content %}
<div class="row mb-4">
  <div class="col-12">
    <h2><i class="fas fa-calendar-alt me-2"></i>Análisis Temporal</h2>
    <p class="text-muted">Evolución de las asistencias a lo largo del tiempo</p>
  </div>
</div>

<!-- Sección de Gráficos -->
<div class="row mb-4">
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Tendencia Mensual de Asistencias</h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_tendencia_mensual %}
        <img
          src="data:image/png;base64,{{ grafico_tendencia_mensual|safe }}"
          class="img-fluid"
          alt="Gráfico Tendencia Mensual"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Distribución de Ayudas por Año</h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_ayudas_por_ano %}
        <img
          src="data:image/png;base64,{{ grafico_ayudas_por_ano|safe }}"
          class="img-fluid"
          alt="Gráfico Ayudas por Año"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          Distribución Mensual de Ayudas Humanitarias
        </h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_ayudas_mensual %}
        <img
          src="data:image/png;base64,{{ grafico_ayudas_mensual|safe }}"
          class="img-fluid"
          alt="Gráfico Ayudas Mensual"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Distribución Anual de Ayuda Principal</h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_distribucion_anual_ayuda_principal %}
        <img
          src="data:image/png;base64,{{ grafico_distribucion_anual_ayuda_principal|safe }}"
          class="img-fluid"
          alt="Gráfico Distribución Anual Ayuda Principal"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Botón para mostrar/ocultar tablas -->
<div class="row mb-3">
  <div class="col-12 text-center">
    <button
      class="btn btn-secondary"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#collapseTemporalTables"
      aria-expanded="false"
      aria-controls="collapseTemporalTables"
    >
      Mostrar/Ocultar Tablas Temporales
    </button>
  </div>
</div>

<!-- Contenedor colapsable para las tablas -->
<div class="collapse show" id="collapseTemporalTables">
  <!-- Estadísticas Anuales -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-chart-line me-2"></i>
            Resumen Anual
          </h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Año</th>
                  <th>Total Registros</th>
                  <th>Total Ayudas</th>
                  <th>Promedio Mensual</th>
                </tr>
              </thead>
              <tbody>
                {% for ano in datos_anuales %}
                <tr>
                  <td><strong>{{ ano.ano }}</strong></td>
                  <td>
                    <span class="badge bg-info">{{ ano.total_registros }}</span>
                  </td>
                  <td>
                    <span class="badge bg-warning">{{ ano.total_ayudas }}</span>
                  </td>
                  <td>
                    <span class="badge bg-secondary"
                      >{{ ano.promedio_mensual|floatformat:1 }}</span
                    >
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center">
                    No hay datos disponibles
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estadísticas Mensuales -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-calendar me-2"></i>
            Detalle Mensual
          </h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Año</th>
                  <th>Mes</th>
                  <th>Total Registros</th>
                  <th>Total Ayudas</th>
                </tr>
              </thead>
              <tbody>
                {% for mes in datos_mensuales %}
                <tr>
                  <td>{{ mes.ano }}</td>
                  <td>
                    <strong> {{ mes.mes_nombre }} </strong>
                  </td>
                  <td>
                    <span class="badge bg-info">{{ mes.total_registros }}</span>
                  </td>
                  <td>
                    <span class="badge bg-warning">{{ mes.total_ayudas }}</span>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center">
                    No hay datos disponibles
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
