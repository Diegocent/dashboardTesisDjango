{% extends 'base.html' %} {% block content %}
<div class="row mb-4">
  <div class="col-12">
    <h2><i class="fas fa-map-marked-alt me-2"></i>Análisis Geográfico</h2>
    <p class="text-muted">
      Distribución de asistencias por ubicación geográfica
    </p>
  </div>
</div>

<!-- Sección de Gráficos -->
<div class="row mb-4">
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          Distribución de Asistencias por Departamento
        </h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_departamentos %}
        <img
          src="data:image/png;base64,{{ grafico_departamentos|safe }}"
          class="img-fluid"
          alt="Gráfico de Departamentos"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Localidades con más Eventos Registrados</h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_top_localidades %}
        <img
          src="data:image/png;base64,{{ grafico_top_localidades|safe }}"
          class="img-fluid"
          alt="Gráfico Top Localidades"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          Departamentos con más Asistencias por Año
        </h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_evolucion_ayudas_top_departamentos %}
        <img
          src="data:image/png;base64,{{ grafico_evolucion_ayudas_top_departamentos|safe }}"
          class="img-fluid"
          alt="Gráfico Evolución Ayudas Top Departamentos"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          Mapa de Calor: Distribución de Asistencias por Departamento y Año
        </h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_heatmap_departamento_anio %}
        <img
          src="data:image/png;base64,{{ grafico_heatmap_departamento_anio|safe }}"
          class="img-fluid"
          alt="Gráfico Heatmap Departamento Año"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Botón para mostrar/ocultar tablas -->
<div class="row mb-3">
  <div class="col-12 text-center">
    <button
      class="btn btn-secondary"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#collapseGeoTables"
      aria-expanded="false"
      aria-controls="collapseGeoTables"
    >
      Mostrar/Ocultar Tablas Geográficas
    </button>
  </div>
</div>

<!-- Contenedor colapsable para las tablas -->
<div class="collapse show" id="collapseGeoTables">
  <!-- Estadísticas por Departamento -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-map me-2"></i>
            Resumen por Departamento
          </h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Departamento</th>
                  <th>Total Registros</th>
                  <th>Kit A</th>
                  <th>Kit B</th>
                  <th>Total Ayudas</th>
                </tr>
              </thead>
              <tbody>
                {% for dept in datos_departamentos %}
                <tr>
                  <td><strong>{{ dept.departamento }}</strong></td>
                  <td>
                    <span class="badge bg-info"
                      >{{ dept.total_registros }}</span
                    >
                  </td>
                  <td>
                    <span class="badge bg-success">{{ dept.total_kit_a }}</span>
                  </td>
                  <td>
                    <span class="badge bg-primary">{{ dept.total_kit_b }}</span>
                  </td>
                  <td>
                    <span class="badge bg-warning"
                      >{{ dept.total_ayudas }}</span
                    >
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="5" class="text-center">
                    No hay datos disponibles
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estadísticas por Distrito -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-city me-2"></i>
            Detalle por Distrito
          </h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Departamento</th>
                  <th>Distrito</th>
                  <th>Total Registros</th>
                  <th>Total Ayudas</th>
                </tr>
              </thead>
              <tbody>
                {% for distrito in datos_distritos %}
                <tr>
                  <td>{{ distrito.departamento }}</td>
                  <td><strong>{{ distrito.distrito }}</strong></td>
                  <td>
                    <span class="badge bg-info"
                      >{{ distrito.total_registros }}</span
                    >
                  </td>
                  <td>
                    <span class="badge bg-warning"
                      >{{ distrito.total_ayudas }}</span
                    >
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center">
                    No hay datos disponibles
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
