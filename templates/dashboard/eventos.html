{% extends 'base.html' %} {% block content %}
<div class="row mb-4">
  <div class="col-12">
    <h2>
      <i class="fas fa-exclamation-triangle me-2"></i>Análisis por Eventos
    </h2>
    <p class="text-muted">Distribución de asistencias según tipo de evento</p>
  </div>
</div>

<!-- Sección de Gráficos -->
<div class="row mb-4">
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          Distribución de asistencias por Tipo de Evento
        </h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_eventos %}
        <img
          src="data:image/png;base64,{{ grafico_eventos|safe }}"
          class="img-fluid"
          alt="Gráfico de Eventos"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Eventos con Mayor Unidades distribuidas</h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_eventos_mayor_ayuda %}
        <img
          src="data:image/png;base64,{{ grafico_eventos_mayor_ayuda|safe }}"
          class="img-fluid"
          alt="Gráfico Eventos Mayor Ayuda"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          Composición de Ayudas por Tipo de Evento (Normalizado por Evento)
        </h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_composicion_ayudas_por_evento %}
        <img
          src="data:image/png;base64,{{ grafico_composicion_ayudas_por_evento|safe }}"
          class="img-fluid"
          alt="Gráfico Composición Ayudas por Evento"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Eventos por mayor distribución.</h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_top_eventos_frecuentes_seaborn %}
        <img
          src="data:image/png;base64,{{ grafico_top_eventos_frecuentes_seaborn|safe }}"
          class="img-fluid"
          alt="Gráfico Top Eventos Frecuentes Seaborn"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Comparación de Eventos por Año</h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_comparacion_eventos_por_anio %}
        <img
          src="data:image/png;base64,{{ grafico_comparacion_eventos_por_anio|safe }}"
          class="img-fluid"
          alt="Gráfico Comparación Eventos por Año"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          Mapa de Calor: Eventos más Comunes por Año
        </h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_heatmap_eventos_por_anio %}
        <img
          src="data:image/png;base64,{{ grafico_heatmap_eventos_por_anio|safe }}"
          class="img-fluid"
          alt="Gráfico Heatmap Eventos por Año"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6 col-md-12 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">Número de Eventos Mensual</h5>
      </div>
      <div class="card-body text-center">
        {% if grafico_tendencia_mensual_eventos_alternativo %}
        <img
          src="data:image/png;base64,{{ grafico_tendencia_mensual_eventos_alternativo|safe }}"
          class="img-fluid"
          alt="Gráfico Tendencia Mensual Eventos Alternativo"
        />
        {% else %}
        <p class="text-muted">No hay datos para mostrar este gráfico.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Botón para mostrar/ocultar tablas -->
<div class="row mb-3">
  <div class="col-12 text-center">
    <button
      class="btn btn-secondary"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#collapseEventTables"
      aria-expanded="false"
      aria-controls="collapseEventTables"
    >
      Mostrar/Ocultar Tablas de Eventos
    </button>
  </div>
</div>

<!-- Contenedor colapsable para las tablas -->
<div class="collapse show" id="collapseEventTables">
  <!-- Estadísticas por Tipo de Evento -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-list me-2"></i>
            Resumen por Tipo de Evento
          </h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Tipo de Evento</th>
                  <th>Total Registros</th>
                  <th>Kit A</th>
                  <th>Kit B</th>
                  <th>Total Ayudas</th>
                </tr>
              </thead>
              <tbody>
                {% for evento in datos_eventos %}
                <tr>
                  <td><strong>{{ evento.evento }}</strong></td>
                  <td>
                    <span class="badge bg-info"
                      >{{ evento.total_registros }}</span
                    >
                  </td>
                  <td>
                    <span class="badge bg-success"
                      >{{ evento.total_kit_a }}</span
                    >
                  </td>
                  <td>
                    <span class="badge bg-primary"
                      >{{ evento.total_kit_b }}</span
                    >
                  </td>
                  <td>
                    <span class="badge bg-warning"
                      >{{ evento.total_ayudas }}</span
                    >
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="5" class="text-center">
                    No hay datos disponibles
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Eventos por Departamento -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-map-marked-alt me-2"></i>
            Eventos por Departamento
          </h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Departamento</th>
                  <th>Tipo de Evento</th>
                  <th>Total Registros</th>
                  <th>Total Ayudas</th>
                </tr>
              </thead>
              <tbody>
                {% for item in eventos_departamento %}
                <tr>
                  <td>{{ item.departamento }}</td>
                  <td><strong>{{ item.evento }}</strong></td>
                  <td>
                    <span class="badge bg-info"
                      >{{ item.total_registros }}</span
                    >
                  </td>
                  <td>
                    <span class="badge bg-warning"
                      >{{ item.total_ayudas }}</span
                    >
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center">
                    No hay datos disponibles
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
